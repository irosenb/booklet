#!/usr/bin/env ruby
# Grabs student profile resumes.

def download(url, n, first, last)

  ext = url.match(/(\w{2,})$/)

  File.open("resume/#{first}#{last}.#{ext}", "w") do |saved_file|
    open(url, 'r') do |read_file|
      saved_file.write(read_file.read)
    end
  end

end

def parse_resume

  count = 0
  id = 1

  txt = ""
  resume_file = File.open("resume/resumes.txt", "w")

  file = File.open("bak/sps.txt").each do |line|

    first_name = ""
    last_name = ""

    line.split("\t").each do |item|
      count += 1
      if count == 2
        first_name = "#{item}"

      elsif count == 3
        last_name = "#{item}"

      elsif count == 6 and "#{item}".include?("(")

        url = "#{item}".scan(/\(([^\)]+)\)/)[0][0]

        if (! (url.match(/\/$/)) ) and ( url.match(/\w+\./) )
          txt << "#{url}\n"
          download("#{url}", id, first_name, last_name)
        end

      end

    end

    count = 0
    id += 1
    
  end

  resume_file << txt
  resume_file.close

end
